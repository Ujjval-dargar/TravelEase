<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Payment Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background-color: #f2f2f2;
    }

    .container {
      max-width: 500px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      margin-bottom: 1rem;
    }

    .item {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }

    .payment-methods label {
      display: block;
      margin: 0.5rem 0;
    }

    .buttons {
      margin-top: 2rem;
    }

    .btn {
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-right: 1rem;
    }

    .confirm {
      background-color: #007bff;
      color: white;
    }

    .cancel {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2>Payment</h2>
    <div class="item" id="item-name">Loading item...</div>

    <div id="payment-form">
      <div class="payment-methods">
        <label><input type="radio" name="method" value="Credit Card" checked> Credit Card</label>
        <label><input type="radio" name="method" value="Debit Card" checked> Debit Card</label>
        <label><input type="radio" name="method" value="UPI"> UPI</label>
        <label><input type="radio" name="method" value="Net Banking"> Net Banking</label>
      </div>

      <div class="buttons">
        <button type="button" class="btn confirm" onclick="confirmPayment()">Confirm Payment</button>
        <button type="button" class="btn cancel" onclick="cancel()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // Extract item from URL
    const params = new URLSearchParams(window.location.search);
    const item = params.get("item");
    const price = params.get("price");
    const user_id = params.get("user_id");

    if (!(item && price)) {
      document.getElementById("item-name").innerHTML = "No item specified";
    }

    document.getElementById("item-name").innerHTML = `
        <table style="width: 100%; border-collapse: collapse;">
          <tr>
            <th style="text-align: left; padding: 8px;">Item</th>
            <td style="padding: 8px;">${item}</td>
          </tr>
          <tr>
            <th style="text-align: left; padding: 8px;">Price</th>
            <td style="padding: 8px;">${price}</td>
          </tr>
        </table>
      `;

    async function confirmPayment() {
      const method = document.querySelector('input[name="method"]:checked').value;
      alert(`Payment confirmed for "${item}" via ${method.toUpperCase()}`);
      // Here you could redirect to a real payment gateway
      // Prepare the payment data to send to the backend
      const paymentData = {
        user_id: user_id,
        amount: price,
        payment_method: method,
        payment_status: 'Confirmed', // In real case, this should be dynamic based on payment gateway response
        transport_type: 'Train', // You can update the type of booking dynamically
        status: 'Confirmed', // Status of booking
        booking_date: new Date().toISOString().split('T')[0] // current date in 'YYYY-MM-DD' format
      };

      // Send payment details to the backend to insert into the database
      try {
        const response = await fetch('/api/confirm_payment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(paymentData),
        });

        const result = await response.json();
        if (result.success) {
          alert(`Payment confirmed for "${item}" via ${method.toUpperCase()}`);
          window.location.href = `/profile?user_id=${user_id}`;
        } else {
          alert('Payment failed, please try again.');
        }
      } catch (error) {
        alert('Error processing payment. Please try again.');
      }


      window.location.href = `/profile?user_id=${user_id}`;
    }

    function cancel() {
      window.history.back(); // Or use: window.location.href = "booking.html";
    }
  </script>
</body>

</html>